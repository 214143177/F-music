<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>音乐播放器</title>
        <style>
            :root {
                --primary-color: #e0e5ec;
                --shadow-light: rgba(255, 255, 255, 0.5);
                --shadow-dark: rgba(163, 177, 198, 0.5);
                --accent-color: #6a7efc;
                --text-color: #4d4d4d;
                --tab-active-color: #6a7efc;
                --tab-inactive-color: #8a8a8a;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                background-color: var(--primary-color);
                color: var(--text-color);
                display: flex;
                flex-direction: column;
                height: 100vh;
                padding: 0;
                overflow: hidden;
            }

            /* 主内容容器 */
            .main-content {
                flex: 1;
                overflow: hidden;
                position: relative;
                width: 100%;
            }

            /* 标签内容容器 */
            .tab-content {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                padding: 15px;
                overflow-y: auto;
                display: none;
                -webkit-overflow-scrolling: touch;
            }

            .tab-content.active {
                display: block;
                animation: fadeIn 0.3s ease;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            /* 底部标签栏 */
            .tab-bar {
                display: flex;
                height: 60px;
                background-color: var(--primary-color);
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
                z-index: 10;
            }

            .tab-item {
                flex: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                color: var(--tab-inactive-color);
                font-size: 12px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .tab-item.active {
                color: var(--tab-active-color);
            }

            .tab-icon {
                font-size: 22px;
                margin-bottom: 3px;
            }

            /* 播放器样式 */
            .player-container {
                display: flex;
                flex-direction: column;
                height: 100%;
            }

            .album-art-container {
                display: flex;
                justify-content: center;
                margin: 20px 0;
            }

            .album-art {
                width: 220px;
                height: 220px;
                border-radius: 15px;
                overflow: hidden;
                box-shadow:
                    8px 8px 15px var(--shadow-dark),
                    -8px -8px 15px var(--shadow-light);
            }

            .album-art img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .song-info {
                text-align: center;
                margin-bottom: 25px;
                padding: 0 15px;
            }

            .song-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 5px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .song-artist {
                font-size: 14px;
                opacity: 0.7;
            }

            .progress-container {
                width: 100%;
                height: 4px;
                background-color: rgba(0, 0, 0, 0.05);
                border-radius: 2px;
                margin-bottom: 10px;
                cursor: pointer;
                box-shadow:
                    inset 2px 2px 4px var(--shadow-dark),
                    inset -2px -2px 4px var(--shadow-light);
            }

            .progress-bar {
                height: 100%;
                background-color: var(--accent-color);
                border-radius: 2px;
                width: 0%;
                transition: width 0.1s linear;
            }

            .time-display {
                display: flex;
                justify-content: space-between;
                font-size: 12px;
                margin-bottom: 25px;
                opacity: 0.7;
            }

            .controls {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-bottom: 25px;
            }

            .control-btn {
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0 8px;
                cursor: pointer;
                box-shadow:
                    5px 5px 10px var(--shadow-dark),
                    -5px -5px 10px var(--shadow-light);
                transition: all 0.2s;
                border: none;
                background-color: var(--primary-color);
                color: var(--text-color);
            }

            .control-btn:active {
                box-shadow:
                    inset 3px 3px 5px var(--shadow-dark),
                    inset -3px -3px 5px var(--shadow-light);
            }

            .play-btn {
                width: 55px;
                height: 55px;
                background-color: var(--accent-color);
                color: white;
                box-shadow:
                    5px 5px 10px var(--shadow-dark),
                    -5px -5px 10px var(--shadow-light),
                    inset 2px 2px 5px rgba(255, 255, 255, 0.3);
            }

            .play-btn:active {
                box-shadow:
                    inset 3px 3px 5px rgba(0, 0, 0, 0.2),
                    inset -3px -3px 5px rgba(255, 255, 255, 0.2);
            }

            .volume-container {
                display: flex;
                align-items: center;
                margin-bottom: 20px;
                padding: 0 15px;
            }

            .volume-icon {
                margin-right: 10px;
                font-size: 16px;
                min-width: 20px;
            }

            .volume-slider {
                flex-grow: 1;
                height: 4px;
                background-color: rgba(0, 0, 0, 0.05);
                border-radius: 2px;
                cursor: pointer;
                box-shadow:
                    inset 2px 2px 4px var(--shadow-dark),
                    inset -2px -2px 4px var(--shadow-light);
                appearance: none;
            }

            .volume-slider::-webkit-slider-thumb {
                appearance: none;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background-color: var(--accent-color);
                cursor: pointer;
            }

            /* 播放列表样式 */
            .playlist {
                height: calc(100% - 20px);
                overflow-y: auto;
                padding-right: 5px;
                -webkit-overflow-scrolling: touch;
            }

            .playlist-item {
                display: flex;
                align-items: center;
                padding: 12px 15px;
                border-radius: 10px;
                margin-bottom: 10px;
                cursor: pointer;
                transition: all 0.2s;
                box-shadow:
                    3px 3px 6px var(--shadow-dark),
                    -3px -3px 6px var(--shadow-light);
            }

            .playlist-item:hover {
                background-color: rgba(0, 0, 0, 0.03);
            }

            .playlist-item.active {
                background-color: var(--accent-color);
                color: white;
                box-shadow:
                    inset 3px 3px 5px rgba(0, 0, 0, 0.2),
                    inset -3px -3px 5px rgba(255, 255, 255, 0.2);
            }

            .playlist-item img {
                width: 45px;
                height: 45px;
                border-radius: 8px;
                margin-right: 15px;
                object-fit: cover;
            }

            .playlist-item-info {
                flex-grow: 1;
                min-width: 0;
            }

            .playlist-item-title {
                font-size: 15px;
                margin-bottom: 3px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .playlist-item-artist {
                font-size: 13px;
                opacity: 0.7;
            }

            .playlist-item.active .playlist-item-artist {
                opacity: 0.9;
            }

            .playlist-item-duration {
                font-size: 13px;
                opacity: 0.7;
                margin-left: 10px;
            }

            .playlist-item.active .playlist-item-duration {
                opacity: 0.9;
            }

            /* 音乐源样式 */
            .source-container {
                height: calc(100% - 20px);
                overflow-y: auto;
                padding-right: 5px;
                -webkit-overflow-scrolling: touch;
            }

            .source-section {
                margin-bottom: 25px;
            }

            .source-title {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 15px;
                color: var(--accent-color);
            }

            .input-group {
                display: flex;
                margin-bottom: 15px;
            }

            .url-input {
                flex: 1;
                padding: 12px 15px;
                border: none;
                border-radius: 10px;
                background-color: var(--primary-color);
                box-shadow:
                    inset 3px 3px 5px var(--shadow-dark),
                    inset -3px -3px 5px var(--shadow-light);
                font-size: 14px;
            }

            .btn {
                padding: 12px 20px;
                border: none;
                border-radius: 10px;
                background-color: var(--primary-color);
                box-shadow:
                    5px 5px 10px var(--shadow-dark),
                    -5px -5px 10px var(--shadow-light);
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
                font-size: 14px;
            }

            .btn:active {
                box-shadow:
                    inset 3px 3px 5px var(--shadow-dark),
                    inset -3px -3px 5px var(--shadow-light);
            }

            .btn-primary {
                background-color: var(--accent-color);
                color: white;
            }

            .file-input {
                display: none;
            }

            .info-text {
                font-size: 13px;
                opacity: 0.7;
                margin-top: 10px;
                line-height: 1.4;
            }

            /* 旋转动画 */
            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }

            .rotate {
                animation: rotate 20s linear infinite;
            }

            .paused {
                animation-play-state: paused;
            }

            /* 自定义滚动条 */
            ::-webkit-scrollbar {
                width: 5px;
            }

            ::-webkit-scrollbar-track {
                background: rgba(0, 0, 0, 0.05);
                border-radius: 3px;
            }

            ::-webkit-scrollbar-thumb {
                background: var(--accent-color);
                border-radius: 3px;
            }

            /* 空状态提示 */
            .empty-message {
                text-align: center;
                margin-top: 50px;
                font-size: 15px;
                opacity: 0.7;
            }

            /* 响应式调整 */
            @media (max-width: 400px) {
                .album-art {
                    width: 200px;
                    height: 200px;
                }

                .control-btn {
                    width: 40px;
                    height: 40px;
                    margin: 0 6px;
                }

                .play-btn {
                    width: 50px;
                    height: 50px;
                }

                .tab-icon {
                    font-size: 20px;
                }

                .tab-item {
                    font-size: 11px;
                }
            }

            @media (max-width: 350px) {
                .album-art {
                    width: 180px;
                    height: 180px;
                }

                .song-title {
                    font-size: 16px;
                }

                .playlist-item {
                    padding: 10px 12px;
                }

                .playlist-item img {
                    width: 40px;
                    height: 40px;
                    margin-right: 12px;
                }
            }
        </style>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </head>

    <body>
        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 播放器标签页 -->
            <div class="tab-content active" id="player-tab">
                <div class="player-container">
                    <div class="album-art-container">
                        <div class="album-art">
                            <img src="https://picsum.photos/400/400" alt="Album Art" id="albumArt">
                        </div>
                    </div>

                    <div class="song-info">
                        <div class="song-title" id="songTitle">歌曲名称</div>
                        <div class="song-artist" id="songArtist">艺术家</div>
                    </div>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>

                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>

                    <div class="controls">
                        <button class="control-btn" id="shuffleBtn" title="随机播放">
                            <i class="fas fa-random"></i>
                        </button>
                        <button class="control-btn" id="prevBtn" title="上一曲">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-btn" id="playBtn" title="播放/暂停">
                            <i class="fas fa-play" id="playIcon"></i>
                        </button>
                        <button class="control-btn" id="nextBtn" title="下一曲">
                            <i class="fas fa-step-forward"></i>
                        </button>
                        <button class="control-btn" id="repeatBtn" title="循环播放">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>

                    <div class="volume-container">
                        <i class="fas fa-volume-up volume-icon"></i>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01"
                            value="0.7">
                    </div>
                </div>
            </div>

            <!-- 播放列表标签页 -->
            <div class="tab-content" id="playlist-tab">
                <div class="playlist" id="playlist">
                    <div class="empty-message">暂无歌曲，请先添加音乐源</div>
                </div>
            </div>

            <!-- 音乐源标签页 -->
            <div class="tab-content" id="source-tab">
                <div class="source-container">
                    <div class="source-section">
                        <div class="source-title">从API获取音乐</div>
                        <div class="input-group">
                            <input type="text" class="url-input" id="apiUrlInput"
                                placeholder="输入API地址 (例如: http://localhost:3000/api/songs)">
                        </div>
                        <button class="btn btn-primary" id="fetchApiBtn">获取歌曲</button>
                        <div class="info-text">API应返回包含title, artist, src, cover, duration字段的JSON数组</div>
                    </div>

                    <div class="source-section">
                        <div class="source-title">从本地文件夹获取</div>
                        <input type="file" id="fileInput" webkitdirectory directory multiple class="file-input">
                        <button class="btn btn-primary" id="selectFolderBtn">选择文件夹</button>
                        <div class="info-text">支持MP3文件，将自动解析ID3标签获取歌曲信息</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部标签栏 -->
        <div class="tab-bar">
            <div class="tab-item active" data-tab="player-tab">
                <div class="tab-icon"><i class="fas fa-music"></i></div>
                <div>播放器</div>
            </div>
            <div class="tab-item" data-tab="playlist-tab">
                <div class="tab-icon"><i class="fas fa-list"></i></div>
                <div>播放列表</div>
            </div>
            <div class="tab-item" data-tab="source-tab">
                <div class="tab-icon"><i class="fas fa-database"></i></div>
                <div>音乐源</div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // DOM元素
                const albumArt = document.getElementById('albumArt');
                const songTitle = document.getElementById('songTitle');
                const songArtist = document.getElementById('songArtist');
                const progressBar = document.getElementById('progressBar');
                const progressContainer = document.getElementById('progressContainer');
                const currentTimeEl = document.getElementById('currentTime');
                const durationEl = document.getElementById('duration');
                const playBtn = document.getElementById('playBtn');
                const playIcon = document.getElementById('playIcon');
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const volumeSlider = document.getElementById('volumeSlider');
                const playlist = document.getElementById('playlist');
                const shuffleBtn = document.getElementById('shuffleBtn');
                const repeatBtn = document.getElementById('repeatBtn');
                const tabItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                const apiUrlInput = document.getElementById('apiUrlInput');
                const fetchApiBtn = document.getElementById('fetchApiBtn');
                const fileInput = document.getElementById('fileInput');
                const selectFolderBtn = document.getElementById('selectFolderBtn');

                // 音频对象
                const audio = new Audio();
                let isPlaying = false;
                let currentSongIndex = 0;
                let isShuffle = false;
                let isRepeat = false;
                let songs = [];
                let originalPlaylist = [];

                // 初始化播放器
                function initPlayer() {
                    audio.volume = volumeSlider.value;

                    // 事件监听器
                    playBtn.addEventListener('click', togglePlay);
                    prevBtn.addEventListener('click', prevSong);
                    nextBtn.addEventListener('click', nextSong);
                    volumeSlider.addEventListener('input', setVolume);
                    progressContainer.addEventListener('click', setProgress);
                    audio.addEventListener('timeupdate', updateProgress);
                    audio.addEventListener('ended', handleSongEnd);
                    audio.addEventListener('loadedmetadata', updateDuration);
                    shuffleBtn.addEventListener('click', toggleShuffle);
                    repeatBtn.addEventListener('click', toggleRepeat);

                    // 标签切换
                    tabItems.forEach(item => {
                        item.addEventListener('click', () => switchTab(item.dataset.tab));
                    });

                    // 音乐源相关
                    fetchApiBtn.addEventListener('click', fetchSongsFromApi);
                    selectFolderBtn.addEventListener('click', () => fileInput.click());
                    fileInput.addEventListener('change', handleFileSelect);

                    // 检查本地存储的API地址
                    const savedApiUrl = localStorage.getItem('musicPlayerApiUrl');
                    if (savedApiUrl) {
                        apiUrlInput.value = savedApiUrl;
                    }
                }

                // 从API获取歌曲
                async function fetchSongsFromApi() {
                    const apiUrl = apiUrlInput.value.trim();
                    if (!apiUrl) {
                        alert('请输入API地址');
                        return;
                    }

                    try {
                        const response = await fetch(apiUrl);
                        if (!response.ok) throw new Error('获取歌曲失败');

                        const data = await response.json();
                        if (!Array.isArray(data)) throw new Error('API返回的数据不是数组');

                        // 验证必要字段
                        const requiredFields = ['title', 'artist', 'src'];
                        const isValid = data.every(song =>
                            requiredFields.every(field => field in song)
                        );

                        if (!isValid) throw new Error('歌曲数据缺少必要字段');

                        songs = data.map(song => ({
                            title: song.title || '未知歌曲',
                            artist: song.artist || '未知艺术家',
                            src: song.src,
                            cover: song.cover || 'https://picsum.photos/200/200?random=' + Math.floor(Math.random() * 1000),
                            duration: song.duration || '0:00'
                        }));

                        originalPlaylist = [...songs];
                        currentSongIndex = 0;

                        loadSong(currentSongIndex);
                        renderPlaylist();
                        updateActiveSong();
                        switchTab('player-tab');

                        // 保存API地址
                        localStorage.setItem('musicPlayerApiUrl', apiUrl);
                    } catch (error) {
                        console.error('获取歌曲时出错:', error);
                        alert('获取歌曲失败: ' + error.message);
                    }
                }

                // 处理本地文件夹选择
                async function handleFileSelect(event) {
                    const files = Array.from(event.target.files);
                    const audioFiles = files.filter(file => file.type.startsWith('audio/'));

                    if (audioFiles.length === 0) {
                        alert('未找到音频文件');
                        return;
                    }

                    // 解析音频文件
                    songs = await Promise.all(audioFiles.map(parseAudioFile));
                    originalPlaylist = [...songs];
                    currentSongIndex = 0;

                    loadSong(currentSongIndex);
                    renderPlaylist();
                    updateActiveSong();
                    switchTab('player-tab');
                }

                // 解析音频文件获取元数据
                function parseAudioFile(file) {
                    return new Promise((resolve) => {
                        const url = URL.createObjectURL(file);
                        const audio = new Audio();

                        audio.src = url;
                        audio.addEventListener('loadedmetadata', () => {
                            const duration = formatTime(audio.duration);
                            const fileName = file.name.replace(/\.[^/.]+$/, "");
                            const [artist, title] = fileName.split(' - ').map(s => s.trim());

                            resolve({
                                title: title || fileName,
                                artist: artist || '未知艺术家',
                                src: url,
                                cover: 'https://picsum.photos/200/200?random=' + Math.floor(Math.random() * 1000),
                                duration: duration
                            });
                        });

                        audio.addEventListener('error', () => {
                            resolve({
                                title: file.name.replace(/\.[^/.]+$/, ""),
                                artist: '未知艺术家',
                                src: url,
                                cover: 'https://picsum.photos/200/200?random=' + Math.floor(Math.random() * 1000),
                                duration: '0:00'
                            });
                        });
                    });
                }

                // 加载歌曲
                function loadSong(index) {
                    if (!songs || songs.length === 0) return;

                    const song = songs[index];
                    audio.src = song.src;
                    albumArt.src = song.cover;
                    songTitle.textContent = song.title;
                    songArtist.textContent = song.artist;

                    // 重置旋转动画
                    albumArt.classList.remove('rotate', 'paused');
                    void albumArt.offsetWidth;
                    albumArt.classList.add('rotate');

                    if (!isPlaying) {
                        albumArt.classList.add('paused');
                    }
                }

                // 渲染播放列表
                function renderPlaylist() {
                    if (!songs || songs.length === 0) {
                        playlist.innerHTML = '<div class="empty-message">暂无歌曲，请先添加音乐源</div>';
                        return;
                    }

                    playlist.innerHTML = '';
                    songs.forEach((song, index) => {
                        const playlistItem = document.createElement('div');
                        playlistItem.className = 'playlist-item';
                        playlistItem.dataset.index = index;
                        playlistItem.innerHTML = `
                        <img src="${ song.cover }" alt="${ song.title }">
                        <div class="playlist-item-info">
                            <div class="playlist-item-title">${ song.title }</div>
                            <div class="playlist-item-artist">${ song.artist }</div>
                        </div>
                        <div class="playlist-item-duration">${ song.duration }</div>
                    `;
                        playlistItem.addEventListener('click', () => playSongFromPlaylist(index));
                        playlist.appendChild(playlistItem);
                    });
                }

                // 从播放列表播放歌曲
                function playSongFromPlaylist(index) {
                    currentSongIndex = index;
                    loadSong(currentSongIndex);
                    playSong();
                    updateActiveSong();
                    switchTab('player-tab');
                }

                // 更新活动歌曲样式
                function updateActiveSong() {
                    const playlistItems = document.querySelectorAll('.playlist-item');
                    playlistItems.forEach((item, index) => {
                        item.classList.toggle('active', index === currentSongIndex);
                    });
                }

                // 播放歌曲
                function playSong() {
                    isPlaying = true;
                    playIcon.classList.replace('fa-play', 'fa-pause');
                    albumArt.classList.remove('paused');
                    audio.play().catch(error => {
                        console.error('播放失败:', error);
                        isPlaying = false;
                        playIcon.classList.replace('fa-pause', 'fa-play');
                        albumArt.classList.add('paused');
                    });
                }

                // 暂停歌曲
                function pauseSong() {
                    isPlaying = false;
                    playIcon.classList.replace('fa-pause', 'fa-play');
                    albumArt.classList.add('paused');
                    audio.pause();
                }

                // 切换播放/暂停
                function togglePlay() {
                    isPlaying ? pauseSong() : playSong();
                }

                // 上一曲
                function prevSong() {
                    currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
                    loadSong(currentSongIndex);
                    if (isPlaying) playSong();
                    updateActiveSong();
                }

                // 下一曲
                function nextSong() {
                    currentSongIndex = (currentSongIndex + 1) % songs.length;
                    loadSong(currentSongIndex);
                    if (isPlaying) playSong();
                    updateActiveSong();
                }

                // 歌曲结束处理
                function handleSongEnd() {
                    isRepeat ? (audio.currentTime = 0, audio.play()) : nextSong();
                }

                // 更新进度条
                function updateProgress() {
                    const { duration, currentTime } = audio;
                    const progressPercent = (currentTime / duration) * 100;
                    progressBar.style.width = `${ progressPercent }%`;
                    currentTimeEl.textContent = formatTime(currentTime);
                }

                // 设置进度
                function setProgress(e) {
                    const width = this.clientWidth;
                    const clickX = e.offsetX;
                    const duration = audio.duration;
                    audio.currentTime = (clickX / width) * duration;
                }

                // 更新歌曲总时长
                function updateDuration() {
                    durationEl.textContent = formatTime(audio.duration);
                }

                // 格式化时间
                function formatTime(seconds) {
                    if (isNaN(seconds)) return '0:00';
                    const minutes = Math.floor(seconds / 60);
                    const secs = Math.floor(seconds % 60);
                    return `${ minutes }:${ secs < 10 ? '0' : '' }${ secs }`;
                }

                // 设置音量
                function setVolume() {
                    audio.volume = this.value;
                }

                // 切换随机播放
                function toggleShuffle() {
                    isShuffle = !isShuffle;
                    shuffleBtn.classList.toggle('active', isShuffle);

                    if (isShuffle) {
                        // Fisher-Yates 洗牌算法
                        for (let i = songs.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [songs[i], songs[j]] = [songs[j], songs[i]];
                        }

                        // 确保当前歌曲在随机后仍然播放
                        const currentSong = songs[currentSongIndex];
                        songs.splice(currentSongIndex, 1);
                        songs.unshift(currentSong);
                        currentSongIndex = 0;
                    } else {
                        // 恢复原始顺序
                        songs = [...originalPlaylist];
                        currentSongIndex = songs.findIndex(song => song.title === songTitle.textContent);
                        if (currentSongIndex === -1) currentSongIndex = 0;
                    }

                    renderPlaylist();
                    updateActiveSong();
                }

                // 切换循环播放
                function toggleRepeat() {
                    isRepeat = !isRepeat;
                    repeatBtn.classList.toggle('active', isRepeat);
                }

                // 切换标签页
                function switchTab(tabId) {
                    tabItems.forEach(item => {
                        item.classList.toggle('active', item.dataset.tab === tabId);
                    });

                    tabContents.forEach(content => {
                        content.classList.toggle('active', content.id === tabId);
                    });
                }

                // 初始化播放器
                initPlayer();
            });
        </script>
    </body>

</html>